# TODO

## Defect

### % を含む URL を開く
V3m コマンドで % を含む URLを開くとカレントファイル名に展開されてしまう。

### タグ解析エラー

タグが、> で閉じる前に改行されているとエラーが発生
現状、w3m がタグ内で改行を発生させる html が再現できていない
``
 <test a=''
       b=''>
``

### 折り返されたリンクでの遷移

折り返されたリンクの2行目以降で、call v3m#open_link() しても、ページが開かずにエラーとなる

### セッション復帰時のウィンドウ

セッション復帰時の読み込み時に、ウィンドウがなくなる。バッファはリストされる状態。まず、理由を確認

### :e (引数なし)を実行すると、コンテンツが消える。

期待動作は、 reload?。リロードの場合、再読み込みの場合、履歴も消す?

## Docs

### デフォルトマッピング定義

## Operations

### リンクを開く。new 相当
キーバインド案
CTRL-W_]

### リンクを開く。edit 相当。
キーバインド案
CTRL-]
タグスタックを考慮

### リンクの URL を表示する方法の提供

### フラグメント遷移時のタグスタック対応
リンク遷移時もタグスタックに対応できるか検討
jumplist も検討

### カーソル下の URL をコピー
ノーマルモードで、カーソル下の URL をコピー

### [REOPEN] デフォルトマッピング定義

スペースによる、ページ up/down。ユーザが定義しているマッピングとかぶりそうなため、相応してデフォルト設定を検討

### 現在のバッファを使用して URL を開く

### カレントバッファを v3m で開くコマンド。

    案 v3m://buffer://18 など？

### 外部ブラウザでリンクを開く方法の提供

netrw の機能確認

### 外部ブラウザで現在のページを開く方法の提供

netrw の機能確認

### neovim 対応

async.vim を使用する？

## Features

### 一行目にタイトルを表示
オプション

### ページ一覧
* タイトルとバッファ名を表示
* 番号選択で、切り替えもサポート

### フォームに値を設定できるようにする。
input_alt type=text サポート

### フォームに設定された値の画面上への表示

### フォームのサブミット実施
intpu_alt type=submit サポート

### 履歴の改善
履歴の管理を位置で行う
履歴を戻っても、現在から戻る先までの間の履歴を消さない

### ソース取得機能
ただし、パフォーマンスを考慮し、通常のページ表示時には、ソースを同時に取得しない。

### ContentType または、ファイル拡張子によるコンテンツ変換サポート

外部コマンドもしくは、関数による変換。

     例 md -> html など

### zip 内のページ参照。内部の url 解決も提供

### fragment のリスト表示と、番号選択による遷移

id は、ユーザが理解しにくい内容なので、該当箇所のテキスト要素などを表示することを検討

### [SUSPEND] ヘッダータグの階層表示と、番号選択による遷移

w3m のダンプには、ヘッダ情報がふくまれないので難しい


## Rendering

### `<u>` のサポート
### レンダリングに指定する最小幅を設定
デフォルト値をどうするか(スマホ向けページ等があるのでデフォルトなし?)

### リンクハイライト表示
カーソルがリンク上にある場合のリンクハイライト表示

### 行末の空白を消込モード
行末の空白を消し込む。モードとする。デフォルトは消込モード。コピーの際に邪魔となるため


### タグとハイライトグループの整理


## Implements

### ページパース時に、フォームの情報構築
form_int, input_alt タグ fid属性
```
fid*
  form_int
    method
    action
    name
  input_alt*
    type
    name
    value
    maxlength
    #displaylength
```

### ホームページは、履歴に含めない

### フォーム関連タグの解析
fid で分類？

### データ取得処理の分離
カスタマイズのため。 zip 内 html, md, キャッシュ処理など

### ロード時に、ページ読み込み時間の表示

### ページロード時のタイムアウト設定

### page 構築実装からの channel 隠蔽
多分、neovim 対応に役立つ

### v3m#back(), v3m#back_history() の整理

### vital.vim を利用した、 url エンコーディング・デコーディング
実体参照も検討

### url エンコーディング対応
url に関して、内部ではデコードした情報で保持。 一致確認などのため

### ページロードキャンセル処理
ロード仕掛中のページで、新たな操作をした場合に、仕掛中の結果を無視するようにする

### w3m プロセスの同時呼び出し数制限
w3m プロセスの同時呼び出し数を設定できるようにする。


## Test

### 各コマンドのテスト
### <Plug> 定義のテスト
### ダウンロードとなるリンク遷移時の動作

## others

### 任意バッファで、カーソル下にある URL を開く関数

## 機能要件を満たさない場合の通知に関して、他のプラグインでの動作を調べる

# DONE

## Defect

### スラッシュなしで開始する相対リンク。 
最初のパスセグメントがドメイン扱いとなっている
```
current: /xxxx/yyy/zzz
link: aaa/bbb.html
resolve: https://aaa/bbb.html
-> 
resolve: /xxxx/yyy/aaa/bbb.html
```
現在のページからの相対 URL を参照する
-> スキームが指定されていない場合の、URL 解決を修正

### 履歴の消込

履歴番号で遷移した場合、不要な履歴が消し込まれない。

消し込まずに、カーソルが移動する方式でも良いかも

### :e v3m://` で g:v3m#homepage が表示されない

一部のマシンで、 `:e v3m://` を実行した際に、g:v3m### homepage が設定されていても、ページが表示されない場合がある
バッファ変数が正常に設定されていないことが原因となっている。このケースで bufload() は、エラーとなっていた。
-> バッファのリネーム処理の際の、リネーム前の名前を持つバッファ消込処理に問題があった。正しいバッファ番号が取得されていなかった

### 同一 URL を開く際のバッファ処理

一回開いたバッファで、"戻る"等などで同じ URL を再び開こうとすると、別のバッファが使用される。 :file で名前を変えると、元
の名前のバッファが unlisted で作成されるため

### fragment に遷移しないケースがある

     `<_id id="">` として解釈されるケースがある。
     `<h2 id="aaa">aaa</h2>`
     そもそも、fragment はアンカータグだけでない

## Docs
### 初期ドキュメント作成
### g:v3m#homepage

## Operations

### 現在のバッファでブックマークを開く
キーバインド案
\<S-B>

### 履歴の表示。番号付き
<Plug>(v3m-show-history)

### 履歴番号を使用した「戻る」
<Plug>(v3m-show-history)

### location bar の提供
現在の URL が確認可能。新規 URL を入力し、移動可能なこと -> <Plug>(v3m-show-locationbar)

### 現在ページの URL を表示する方法の提供
<Plug>(v3m-show-locationbar)

### file:// 対応
### リンクを開く
### リンクを新規タプで開く。
<Plug>(v3m-open-link-tab)

### 遷移履歴の保持
### 戻る機能
### TAB キーによるリンク遷移
### SHIFT-TAB キーによるリンク遷移
### LeftMouse によるリンク遷移

## Features

### 機能要件のチェック。 w3m, +job, +channel など
### デフォルトページサポート  -> g:v3m#homepage
### BufReadCmd 対応。 -> e v3m://{URL}

## Rendering

### レンダリングに指定する最大幅を設定
デフォルト値をどうするか(80 x 1.5 or 2 程度?)

## Implements

### 属性の実体参照デコード

     `id="&lt;init%gt;()"`

### fragment のマッチング時に、href の URL エンコーディング展開して比較

     `href="%3Cinit%3E()"`

### 専用のファイルタイプ作成
### キーマッピングをファイルタイプベースで設定できるようにする
### url 内の、相対パスアクセスの正規化。. ゃ ..
### 閉じタグなしへの対応
open タグに対応する閉じタグより前に、他の閉じタグが発生した場合 open タグも閉じる。

### id へのリンク対応。リロードしない。
### a タグの id サポート。リンク先の候補に含める。
### a タグのアンカーポイントとリンクを区別する。

## DISCARD

## Implements
### ファイルの連番を廃止
多分不要なため
-> :file  実行時、同名のファイルがあるとエラーとなるため、必要

